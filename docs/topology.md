# Topology
进程的拓扑信息，包含每个进程所在的节点、NUMA、Socket等信息，依据这些信息可以得出两两进程间的距离信息。部分算法需要距离信息来决定集合操作的通讯步骤。

距离信息是一个二维矩阵，假设通信组内有4个进程：P0、P1、P2、P3，其距离信息如下
```
   P0 P1 P2 P3
P0 0  1  2  3
P1 1  0  4  5
P2 2  4  0  6
P3 3  5  6  0
```
如果存储二维矩阵，那么空间复杂度为O(N^2)，N为进程个数。当进程数增加至1万，那么每个进程都需要占用100MB，假设PPN=100，那么单节点就由10GB内存被占用。

## 设计
1. 使用共享内存，每个节点保存一份即可。
2. 因为`distance[x][y]`和`distance[y][x]`是一样的，所以只需保存上三角矩阵
3. 因为`distance[x][x]`必然是0，所以无需保存对角线

综上可以使用一维数组来保存距离信息,
1. 数组[0, N-1)保存0到1~N-1的距离
2. [N-1, 2N-3)保存1到2~N-1的距离
3. 以此类推

伪码如下
```
if x == y
    return 0
if x > y
    swap(x, y)
the distance of x and y :=  distance[x*(N-1+N-x)/2 + y-x-1]
```